---
title: "Add Usage"
description: "Public API for ingesting Usage events for billing and metering."
---

# ‚ûï Add Usage

This API allows clients to report usage events to the billing system for processing and aggregation. These events are grouped and priced based on contract configuration and usage drivers.

---

## üì• Endpoint

**GET** `https://www.data.valyx.com/usage`

```
GET /usage HTTP/1.1
Host: dat.valyx.com
Authorization: Bearer sk_live_1234567890abcdef
Content-Type: application/json
```

---

### üì§  `curl` Request

```bash
curl -X 'POST' \
  'http://localhost:8181/usage' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer <your_api_key>' \
  -H 'Content-Type: application/json' \
  -d '{
  "buyerId": "string",
  "contractId": "string",
  "count": 0,
  "eventId": "string",
  "quantity": 0,
  "tags": {
    "additionalProp1": "string",
    "additionalProp2": "string",
    "additionalProp3": "string"
  },
  "usageDriverId": "string",
  "usageReferenceId": "string"
}'
```

## Request

<AccordionGroup>
  <Accordion title="Authorization" icon="sparkles" iconType="regular">
    ``` filename
    Authorization: Bearer <your_api_key>
    ```

    Include your API key as a Bearer \<token\> in the Authorization header of your request.
  </Accordion>
  <Accordion title="Body" description="The request body should contain a JSON payload describing a single usage event." icon="sparkles">
    | Field              | Type     | Required | Description                                                                    | Example                                    |
    | ------------------ | -------- | -------- | ------------------------------------------------------------------------------ | ------------------------------------------ |
    | `buyerId`          | `string` | ‚úÖ        | Unique identifier for the buyer (e.g. customer or account)                     | `"BUY12345"`                               |
    | `contractId`       | `string` | ‚ùå        | Contract under which usage is billed. If not provided, resolved automatically. | `"CON45678"`                               |
    | `count`            | `float`  | ‚úÖ        | Number of times the usage occurred                                             | `1`                                        |
    | `eventId`          | `string` | ‚ùå        | Event type identifier (e.g., API call, job, etc.)                              | `"EVT_API_REQUEST"`                        |
    | `eventTimestamp`   | `int64`  | ‚ùå        | Unix timestamp of when the usage occurred                                      | `1721502930`                               |
    | `quantity`         | `float`  | ‚úÖ        | Quantity of usage (e.g., GBs used, requests, hours)                            | `250.5`                                    |
    | `tags`             | `object` | ‚úÖ        | Custom key-value pairs to add dimensions (region, tier, etc.)                  | `{ "region": "us-east-1", "tier": "pro" }` |
    | `usageDriverId`    | `string` | ‚úÖ        | What is being measured ‚Äî e.g., messages sent, compute time                     | `"UDR00123"`                               |
    | `usageReferenceId` | `string` | ‚úÖ        | A unique ID to prevent duplicate submissions                                   | `"REF7890"`                                |
  </Accordion>
</AccordionGroup>

## Response

<Tabs>
  <Tab title="201">
    ```
    {
      "buyerId": "BUY12345",
      "contractId": "CON67890",
      "count": 1,
      "eventId": "API_CALL_001",
      "eventTimestamp": 1721502930,
      "quantity": 150.75,
      "tags": {
        "region": "us-east-1",
        "feature": "upload",
        "tier": "enterprise"
      },
      "usageDriverId": "UDR_CPU_HOURS",
      "usageReferenceId": "REF20250721-001"
    }
    
    ```
  </Tab>
  <Tab title="500">
    ```json
    {
      "details": "fetch customer details: no buyer ID 'string' exists : Error 1146 (42S02): couldn't find customer with id buyer_1234",
      "error": "Failed to process usage data"
    }
    ```
  </Tab>
  <Tab title="400">
    ```json
    {
      "error": "Invalid request body",
      "details": "json: cannot unmarshal string into Go struct field CreateUsageEvent.quantity of type float64"
    }
    
    ```
  </Tab>
</Tabs>

### üìò Notes

- The API is idempotent based on eventId.
- Use usageReferenceId for batch-level billing or to logically group usage activity.
- Invalid or unmatched tags will result in event rejection due to missing rate card linkage.
- Always ensure that eventTimestamp falls within the contract validity period.